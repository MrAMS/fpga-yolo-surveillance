<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Would use latest version, you'd better specify a version -->
    <script src="https://unpkg.com/naive-ui"></script>
    
  </head>
  <body>
    
    <div id="app">    
    </div>
    <template id="template-main">
        <div id="modal" class="modal">
            <h3>ğŸš¨ è§¦å‘æŠ¥è­¦</h3>
            <p>æ‚¨è®¾ç½®çš„è‡ªåŠ¨æŠ¥è­¦è¢«è§¦å‘äº†,ä¸‹é¢æ˜¯è§¦å‘æŠ¥è­¦çš„å¯¹è±¡:</p>
            <div class="mb-3">
                <div class="card" v-for="obj in objs_alert">
                    <img class="card-img-top p-3" :src="obj.img" alt="Card image cap">
                    <div class="card-body">
                        <h5 class="card-title">${ obj.name }$</h5>
                        <p class="card-text">
                            å‡ºç°æ—¶é—´: ${ format_date(obj.date[0]) }$
                            <br>
                            æ¶ˆå¤±æ—¶é—´: ${ format_date(obj.date[1]) }$
                        </p>
                        <p class="card-text"><small class="text-muted">Confidence:${ obj.confidence }$</small></p>
                    </div>
                </div>
            </div>
            <a href="#" rel="modal:close">å…³é—­æŠ¥è­¦</a>
        </div>
        <nav class="navbar navbar-light bg-light justify-content-between">
            <div style="width: 100%;">
                <div>
                    <a class="navbar-brand">åŸºäºPYNQçš„<b>å¤šç›®æ ‡è·Ÿè¸ªæ™ºæ…§ç›‘æ§ç»ˆç«¯</b><small class="ml-3">YOLOv2 on <n-tag :bordered="false" type="warning">FPGA</n-tag> DeepSort, Flask on <n-tag :bordered="false" type="info">ARM</n-tag> </small></a>
                </div>
                <div style="width: 100%;display: flex;align-items: center;">
                    <div class="m-1" style="flex-grow:2">
                        <n-date-picker v-model:value="date_range" type="datetimerange"
                            clearable
                            :is-date-disabled="disablePreviousDate"
                            />
                        <pre>${ date_range_str }$</pre>
                    </div>
                    <div class="m-1" style="flex-grow:1">
                        <n-select v-model:value="type_filters" filterable multiple :options="options" placeholder="ç›®æ ‡ç§ç±»" />
                    </div>
                    <div>
                        <n-button type="primary" @click="fetch_data">
                            ç­›é€‰
                        </n-button>
                    </div>
                </div>
                <div style="width: 100%;display: flex;align-items: center;">
                    <div class="m-1" style="flex-grow:1">
                        <n-select v-model:value="alert_filters" filterable multiple :options="options" placeholder="ç›®æ ‡ç§ç±»" />
                    </div>
                    <div>
                        <n-switch v-model:value="active_alert">
                            <template #checked>
                            å¼€å¯æŠ¥è­¦
                            </template>
                            <template #unchecked>
                            å…³é—­æŠ¥è­¦
                            </template>
                        </n-switch>
                    </div>
                </div>
            </div>
        </nav>
        <div class="container mt-3">
            <div class="card-columns">
                <div class="card" v-for="obj in objs">
                    <img class="card-img-top p-3" :src="obj.img" alt="Card image cap">
                    <div class="card-body">
                        <h5 class="card-title">${ obj.name }$</h5>
                        <p class="card-text">
                            å‡ºç°æ—¶é—´: ${ format_date(obj.date[0]) }$
                            <br>
                            æ¶ˆå¤±æ—¶é—´: ${ format_date(obj.date[1]) }$
                        </p>
                        <p class="card-text"><small class="text-muted">Confidence:${ obj.confidence }$</small></p>
                    </div>
                </div>

            </div>
            
        </div>
    </template>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/dayjs.min.js" integrity="sha512-FwNWaxyfy2XlEINoSnZh1JQ5TRRtGow0D6XcmAWmYCRgvqOUTnzCxPc9uF35u5ZEpirk1uhlPVA19tflhvnW1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.10/locale/zh-cn.min.js" integrity="sha512-t+T+l2qHf4oOrpwGDg3S8lC8AdXeAwkjwaGtUYpbbmc6hs4zHIV9LCO2JXbeCk8THKuKz+0OLYYf8Mh6vg74Nw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        dayjs.locale('zh-cn')
    </script>
    <script>
        const { createApp, ref } = Vue

        createApp({
            setup() {
                const count = ref(0)
                const date_range = ref([Date.now()-100000, Date.now()])
                const date_range_str = Vue.computed(() => {
                    return JSON.stringify(date_range.value)
                })
                const objs = ref([])
                const objs_alert = ref([])
                const active_alert = ref(false);
                const fetch_data = () => {
                    fetch('/api/query',{
                        method: 'POST',
                        headers: {
                        'Content-Type': 'application/json;charset=utf-8'
                        }, 
                        body: JSON.stringify({
                            'types': type_filters.value,
                            'dates': date_range.value,
                        }) 
                    }).then(response => response.json())
                    .then(json => {console.log(json); objs.value = json.return;})
                    .catch(err => console.log('Request Failed', err)); 
                }
                const format_date = (timestamp) => {
                    console.log(timestamp)
                    return dayjs(timestamp*1000).format('YYYY MM-DD HH:mm:ss A')
                }

                Vue.onMounted(() => {
                    let timer = null;
                  //æ¯5såˆ·æ–°æ•°æ®
                    timer = setInterval(() => {
                        if(active_alert.value){
                            fetch('/api/query',{
                                method: 'POST',
                                headers: {
                                'Content-Type': 'application/json;charset=utf-8'
                                }, 
                                body: JSON.stringify({
                                    'types': alert_filters.value,
                                    'dates': [0, Date.now()],
                                }) 
                            }).then(response => response.json()).then(
                                json => {console.log(json);
                                objs_alert.value = json.return;
                                if(objs_alert.value.length!=0){
                                    $('#modal').modal({showClose: false});
                                    active_alert.value = false;
                                }
                            }).catch(
                                err => console.log('Request Failed', err)
                            ); 
                        }
            
                    }, 1000);
                })

                const type_filters = ref(['person'])
                const alert_filters = ref(['person'])
                const options = [
                    {
                        type: 'group',
                        label: 'ç”Ÿç‰©',
                        key: 'living',
                        children: [
                        {
                            label: "äºº",
                            value: 'person',
                        },
                        {
                            label: "é¸Ÿ",
                            value: 'bird',
                        },
                        {
                            label: "çŒ«",
                            value: 'cat',
                        },
                        {
                            label: "ç‹—",
                            value: 'dog',
                        },
                        {
                            label: "é©¬",
                            value: 'horse',
                        },
                        {
                            label: "ç¾Š",
                            value: 'sheep',
                        },
                        {
                            label: "ç‰›",
                            value: 'cow',
                        },
                        {
                            label: "å¤§è±¡",
                            value: 'elephant',
                        },
                        {
                            label: "ç†Š",
                            value: 'bear',
                        },
                        {
                            label: "æ–‘é©¬",
                            value: 'zebra',
                        },
                        {
                            label: "é•¿é¢ˆé¹¿",
                            value: 'giraffe',
                        },
                        ]
                    },
                    {
                        type: 'group',
                        label: 'äº¤é€š',
                        key: 'trafic',
                        children: [
                        {
                            label: 'æ±½è½¦',
                            value: 'car'
                        },
                        {
                            label: 'æ‘©æ‰˜è½¦',
                            value: 'motorbike'
                        },
                        {
                            label: 'è‡ªè¡Œè½¦',
                            value: 'bicycle'
                        },
                        {
                            label: 'é£æœº',
                            value: 'aeroplane'
                        },
                        {
                            label: 'å…¬äº¤è½¦',
                            value: 'bus'
                        },
                        {
                            label: 'ç«è½¦',
                            value: 'train'
                        },
                        {
                            label: 'èˆ¹',
                            value: 'boat'
                        },
                        {
                            label: 'äº¤é€šç¯',
                            value: 'traffic light'
                        },
                        {
                            label: 'æ¶ˆé˜²æ “',
                            value: 'fire hydrant'
                        },
                        {
                            label: 'åœè½¦ç‰Œ',
                            value: 'stop sign'
                        },
                        {
                            label: 'åœè½¦è®¡æ—¶å™¨',
                            value: 'parking meter'
                        },
                        ]
                    },
                    {
                        type: 'group',
                        label: 'éšèº«ç‰©å“',
                        key: 'personal_item',
                        children: [
                        {
                        label: "èƒŒåŒ…",
                        value: 'backpack',
                        },
                        {
                        label: "é›¨ä¼",
                        value: 'umbrella',
                        },
                        {
                        label: "æ‰‹æåŒ…",
                        value: 'handbag',
                        },
                        {
                        label: "é¢†å¸¦",
                        value: 'tie',
                        },
                        {
                        label: "æ‰‹æç®±",
                        value: 'suitcase',
                        }
                        ]
                        },
                        {
                        type: 'group',
                        label: 'è¿åŠ¨è£…å¤‡',
                        key: 'sports_equipment',
                        children: [
                        {
                        label: "é£ç›˜",
                        value: 'frisbee',
                        },
                        {
                        label: "æ»‘é›ªæ¿",
                        value: 'skis',
                        },
                        {
                        label: "æ»‘é›ªæ¿",
                        value: 'snowboard',
                        },
                        {
                        label: "çƒ",
                        value: 'sports ball',
                        },
                        {
                        label: "é£ç­",
                        value: 'kite',
                        },
                        {
                        label: "æ£’çƒæ£’",
                        value: 'baseball bat',
                        },
                        {
                        label: "æ£’çƒæ‰‹å¥—",
                        value: 'baseball glove',
                        },
                        {
                        label: "æ»‘æ¿",
                        value: 'skateboard',
                        },
                        {
                        label: "å†²æµªæ¿",
                        value: 'surfboard',
                        },
                        {
                        label: "ç½‘çƒæ‹",
                        value: 'tennis racket',
                        }
                        ]
                    },
                    {
                        type: 'group',
                        label: 'é¤å…·é£Ÿå“',
                        key: 'tableware_food',
                        children: [
                        {
                        label: "ç“¶å­",
                        value: 'bottle',
                        },
                        {
                        label: "é…’æ¯",
                        value: 'wine glass',
                        },
                        {
                        label: "æ¯å­",
                        value: 'cup',
                        },
                        {
                        label: "å‰å­",
                        value: 'fork',
                        },
                        {
                        label: "åˆ€",
                        value: 'knife',
                        },
                        {
                        label: "å‹ºå­",
                        value: 'spoon',
                        },
                        {
                        label: "ç¢—",
                        value: 'bowl',
                        },
                        {
                        label: "é¦™è•‰",
                        value: 'banana',
                        },
                        {
                        label: "è‹¹æœ",
                        value: 'apple',
                        },
                        {
                        label: "ä¸‰æ˜æ²»",
                        value: 'sandwich',
                        },
                        {
                        label: "æ©™å­",
                        value: 'orange',
                        },
                        {
                        label: "è¥¿å…°èŠ±",
                        value: 'broccoli',
                        },
                        {
                        label: "èƒ¡èåœ",
                        value: 'carrot',
                        },
                        {
                        label: "çƒ­ç‹—",
                        value: 'hot dog',
                        },
                        {
                        label: "æŠ«è¨",
                        value: 'pizza',
                        },
                        {
                        label: "ç”œç”œåœˆ",
                        value: 'donut',
                        },
                        {
                        label: "è›‹ç³•",
                        value: 'cake',
                        }
                        ]
                    },
                    {
                        type: 'group',
                        label: 'å®¶å…·',
                        key: 'furniture',
                        children: [
                        {
                        label: "æ¤…å­",
                        value: 'chair',
                        },
                        {
                        label: "æ²™å‘",
                        value: 'sofa',
                        },
                        {
                        label: "ç›†æ ½",
                        value: 'pottedplant',
                        },
                        {
                        label: "åºŠ",
                        value: 'bed',
                        },
                        {
                        label: "é¤æ¡Œ",
                        value: 'diningtable',
                        },
                        {
                        label: "å•æ‰€",
                        value: 'toilet',
                        },
                        {
                        label: "é•¿æ¤…",
                        value: 'bench',
                        }
                        ]
                    },
                    {
                        type: 'group',
                        label: 'ç”µå­è®¾å¤‡',
                        key: 'electronics',
                        children: [
                        {
                        label: "ç”µè§†æ˜¾ç¤ºå™¨",
                        value: 'tvmonitor',
                        },
                        {
                        label: "ç¬”è®°æœ¬ç”µè„‘",
                        value: 'laptop',
                        },
                        {
                        label: "é¼ æ ‡",
                        value: 'mouse',
                        },
                        {
                        label: "é¥æ§å™¨",
                        value: 'remote',
                        },
                        {
                        label: "é”®ç›˜",
                        value: 'keyboard',
                        },
                        {
                        label: "æ‰‹æœº",
                        value: 'cell phone',
                        },
                        {
                        label: "å¾®æ³¢ç‚‰",
                        value: 'microwave',
                        },
                        {
                        label: "çƒ¤ç®±",
                        value: 'oven',
                        },
                        {
                        label: "çƒ¤é¢åŒ…æœº",
                        value: 'toaster',
                        },
                        {
                        label: "æ°´æ± ",
                        value: 'sink',
                        },
                        {
                        label: "å†°ç®±",
                        value: 'refrigerator',
                        },
                        {
                        label: "ä¹¦",
                        value: 'book',
                        },
                        {
                        label: "æ—¶é’Ÿ",
                        value: 'clock',
                        },
                        {
                        label: "èŠ±ç“¶",
                        value: 'vase',
                        },
                        {
                        label: "å‰ªåˆ€",
                        value: 'scissors',
                        },
                        {
                        label: "æ³°è¿ªç†Š",
                        value: 'teddy bear',
                        },
                        {
                        label: "å¹é£æœº",
                        value: 'hair drier',
                        },
                        {
                        label: "ç‰™åˆ·",
                        value: 'toothbrush',
                        }
                        ]
                    },
                    ];
                return {
                    count,
                    date_range,
                    date_range_str,
                    options,
                    type_filters,
                    alert_filters,
                    disablePreviousDate(ts) {
                        return ts > Date.now();
                    },

                    fetch_data,
                    format_date,
                    objs,
                    objs_alert,
                    active_alert,
                }
            },
            template: '#template-main',
            // for global
            delimiters: ["${", "}$"],
            // for standalone
            compilerOptions: {
                delimiters: ["${", "}$"]
            }
        }).use(naive).mount('#app')
    </script>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha512-3P8rXCuGJdNZOnUx/03c1jOTnMn3rP63nBip5gOP2qmUh5YAdVAvFZ1E+QLZZbC1rtMrQb+mah3AfYW11RUrWA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  

    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>

</body>
</html>